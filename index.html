<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Random Meme</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    background: #000;
    color: #fff;
    font-family: system-ui, sans-serif;
}

#settingsBtn {
    position: fixed;
    top: 10px;
    right: 10px;
    font-size: 22px;
    background: rgba(0,0,0,.6);
    border: none;
    color: white;
    padding: 8px 10px;
    border-radius: 50%;
    cursor: pointer;
    z-index: 10;
}

#memeWrapper {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 10px;
}

#memeContent {
    display: flex;
    justify-content: center;
    align-items: center;
}

img, video {
    max-width: 100%;
    max-height: 80vh;
    border-radius: 8px;
}

#title {
    margin-top: 10px;
    font-size: 0.95rem;
    opacity: 0.85;
    text-align: center;
}

#settings {
    position: fixed;
    inset: 0;
    background: #0f0f0f;
    padding: 20px;
    display: none;
    overflow-y: auto;
}

label {
    display: block;
    margin-top: 15px;
    font-weight: 600;
}

textarea, input {
    width: 100%;
    background: #1a1a1a;
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 10px;
    margin-top: 5px;
}

button.save {
    margin-top: 20px;
    width: 100%;
    padding: 12px;
    background: #ff0055;
    color: #fff;
    border: none;
    border-radius: 10px;
    font-size: 16px;
}
</style>
</head>

<body>

<button id="settingsBtn" onclick="toggleSettings()">‚öôÔ∏è</button>

<div id="memeWrapper" ondblclick="loadMeme()">
    <div id="memeContent">Y√ºkleniyor‚Ä¶</div>
    <div id="title"></div>
</div>

<div id="settings">
    <h2>Ayarlar</h2>

    <label>Subreddit‚Äôler (virg√ºlle)</label>
    <input id="subs">

    <label>Flair‚Äôler (virg√ºlle)</label>
    <textarea id="flairs"></textarea>

    <label>
        <input type="checkbox" id="nsfw"> NSFW izin ver
    </label>

    <button class="save" onclick="saveSettings()">Kaydet</button>
</div>

<script>
const defaultSettings = {
    subs: ["KGBTR", "indirilenler", "vlandiya"],
    flairs: [
        "anlƒ±k",
        "amk b√∂yle i≈üin",
        "Galerimden Fotoƒüraflar/Videolar",
        "shitpost",
        "Meme/Mizah"
    ],
    nsfw: false
};

function getSettings() {
    return JSON.parse(localStorage.getItem("settings")) || defaultSettings;
}

function saveSettings() {
    const settings = {
        subs: subs.value.split(",").map(s => s.trim()).filter(Boolean),
        flairs: flairs.value.split(",").map(f => f.trim()).filter(Boolean),
        nsfw: nsfw.checked
    };
    localStorage.setItem("settings", JSON.stringify(settings));
    toggleSettings();
    loadMeme();
}

function toggleSettings() {
    const panel = document.getElementById("settings");
    panel.style.display = panel.style.display === "block" ? "none" : "block";

    if (panel.style.display === "block") {
        const s = getSettings();
        subs.value = s.subs.join(", ");
        flairs.value = s.flairs.join(", ");
        nsfw.checked = s.nsfw;
    }
}

async function loadMeme() {
    const s = getSettings();
    memeContent.innerHTML = "Y√ºkleniyor‚Ä¶";
    title.innerText = "";

    const sub = s.subs[Math.floor(Math.random() * s.subs.length)];
    const flair = s.flairs[Math.floor(Math.random() * s.flairs.length)];

    const url =
        `https://www.reddit.com/r/${sub}/search.json` +
        `?q=flair:"${encodeURIComponent(flair)}"` +
        `&restrict_sr=1&sort=new&limit=50`;

    const res = await fetch(url);
    const json = await res.json();

    const posts = json.data.children
        .map(p => p.data)
        .filter(p =>
            !p.is_self &&
            (p.post_hint === "image" || p.is_video) &&
            (s.nsfw || !p.over_18)
        );

    if (!posts.length) {
        memeContent.innerText = "Uygun meme bulunamadƒ±.";
        return;
    }

    const post = posts[Math.floor(Math.random() * posts.length)];

    if (post.is_video) {
        memeContent.innerHTML = `
            <video
                src="${post.media.reddit_video.fallback_url}"
                autoplay
                muted
                playsinline
            ></video>
        `;

        const video = memeContent.querySelector("video");
        let userInteracted = false;

        video.addEventListener("click", e => {
            e.stopPropagation();

            if (!userInteracted) {
                video.muted = false; // üîä ilk tƒ±kta ses a√ß
                userInteracted = true;
                video.play();
                return;
            }

            video.paused ? video.play() : video.pause();
        });
    } else {
        memeContent.innerHTML = `<img src="${post.url}">`;
    }

    title.innerText = post.title;
}

loadMeme();
</script>

</body>
</html>
