<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Ranmem</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
    --bg: #0e0e0e;
    --panel: #161616;
    --text: #f1f1f1;
    --muted: #9a9a9a;
    --border: rgba(255,255,255,.08);
}

* {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

html, body {
    margin: 0;
    height: 100%;
    background: var(--bg);
    color: var(--text);
    font-family: system-ui, sans-serif;
}

body {
    overflow: hidden;
}

#topbar {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    background: linear-gradient(to bottom, rgba(0,0,0,.7), transparent);
    z-index: 10;
}

#brand {
    font-weight: 600;
    font-size: 15px;
}

#settingsBtn {
    background: none;
    border: none;
    color: var(--text);
    font-size: 20px;
}

#viewer {
    height: 100%;
    padding-top: 56px;
    padding-bottom: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
}

img, video {
    max-width: 100%;
    max-height: 100%;
    border-radius: 10px;
}

video {
    background: #000;
}

#title {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    padding: 10px 14px;
    text-align: center;
    font-size: 13px;
    color: var(--muted);
    background: linear-gradient(to top, rgba(0,0,0,.7), transparent);
}

/* SETTINGS */
#settings {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    background: var(--panel);
    border-radius: 16px 16px 0 0;
    padding: 16px;
    transform: translateY(100%);
    transition: .25s ease;
    z-index: 20;
}

#settings.open {
    transform: translateY(0);
}

.setting {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid var(--border);
    font-size: 14px;
}

.setting:last-child {
    border-bottom: none;
}

input[type="checkbox"] {
    transform: scale(1.2);
}

input[type="text"] {
    width: 100%;
    margin-top: 8px;
    padding: 6px;
    background: #222;
    border: none;
    color: #fff;
    border-radius: 6px;
}
</style>
</head>
<body>

<div id="topbar">
    <div id="brand">Ranmem</div>
    <button id="settingsBtn">⚙︎</button>
</div>

<div id="viewer"></div>
<div id="title"></div>

<div id="settings">
    <div class="setting">
        <span>Sadece video</span>
        <input type="checkbox" id="onlyVideo">
    </div>
    <div class="setting">
        <span>NSFW</span>
        <input type="checkbox" id="nsfw">
    </div>
    <div class="setting">
        <span>Subreddit’ler (virgülle)</span>
    </div>
    <input type="text" id="subs">
</div>

<script>
"use strict";

/* ====== AYARLAR ====== */
const DEFAULT_SUBS = ["KGBTR", "vlandiya", "indirilenler"];

const viewer = document.getElementById("viewer");
const titleEl = document.getElementById("title");
const settingsEl = document.getElementById("settings");

const onlyVideoEl = document.getElementById("onlyVideo");
const nsfwEl = document.getElementById("nsfw");
const subsEl = document.getElementById("subs");

onlyVideoEl.checked = localStorage.getItem("onlyVideo") === "1";
nsfwEl.checked = localStorage.getItem("nsfw") === "1";
subsEl.value = localStorage.getItem("subs") || DEFAULT_SUBS.join(",");

onlyVideoEl.onchange = () =>
    localStorage.setItem("onlyVideo", onlyVideoEl.checked ? "1" : "0");

nsfwEl.onchange = () =>
    localStorage.setItem("nsfw", nsfwEl.checked ? "1" : "0");

subsEl.onchange = () =>
    localStorage.setItem("subs", subsEl.value);

/* ====== AYAR BUTONU ====== */
document.getElementById("settingsBtn").onclick = () => {
    settingsEl.classList.toggle("open");
};

/* ====== GÖRÜLENLER ====== */
const seen = new Set(JSON.parse(localStorage.getItem("seenPosts") || "[]"));

/* ====== ÇİFT TIK ====== */
let lastTap = 0;
document.body.addEventListener("touchend", () => {
    const now = Date.now();
    if (now - lastTap < 300) loadMeme();
    lastTap = now;
});
document.body.addEventListener("dblclick", loadMeme);

/* ====== MEME YÜKLE ====== */
async function loadMeme() {
    viewer.innerHTML = "";
    titleEl.textContent = "Yükleniyor…";

    const subs = subsEl.value
        .split(",")
        .map(s => s.trim())
        .filter(Boolean);

    while (true) {
        const sub = subs[Math.floor(Math.random() * subs.length)];
        const url = `https://www.reddit.com/r/${sub}/hot.json?limit=50`;

        const res = await fetch(url);
        const json = await res.json();
        const posts = json.data.children.map(c => c.data)
            .sort(() => Math.random() - 0.5);

        for (const post of posts) {
            if (seen.has(post.id)) continue;
            if (!nsfwEl.checked && post.over_18) continue;

            const isVideo = post.is_video;
            const isImage = post.post_hint === "image";

            if (onlyVideoEl.checked && !isVideo) continue;
            if (!isVideo && !isImage) continue;

            seen.add(post.id);
            localStorage.setItem("seenPosts", JSON.stringify([...seen]));

            renderPost(post);
            return;
        }
    }
}

/* ====== RENDER ====== */
function renderPost(post) {
    viewer.innerHTML = "";
    titleEl.textContent = post.title;

    if (post.is_video && post.media?.reddit_video) {
        const video = document.createElement("video");
        video.src = post.media.reddit_video.fallback_url;
        video.autoplay = true;
        video.muted = true;
        video.playsInline = true;

        video.onclick = e => {
            e.stopPropagation();
            video.muted = false;
            video.paused ? video.play() : video.pause();
        };

        viewer.appendChild(video);
    } else {
        const img = document.createElement("img");
        img.src = post.url;
        viewer.appendChild(img);
    }
}

/* ====== BAŞLAT ====== */
loadMeme();
</script>

</body>
</html>
