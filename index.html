<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Ranmem</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
    --bg: #0b0b0b;
    --panel: #111;
    --text: #f2f2f2;
    --muted: #9a9a9a;
    --accent: #ffffff;
}

* {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: var(--bg);
    color: var(--text);
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

body {
    overflow: hidden;
}

#topbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    background: linear-gradient(to bottom, rgba(0,0,0,.6), rgba(0,0,0,0));
    z-index: 10;
}

#brand {
    font-weight: 600;
    letter-spacing: .4px;
    font-size: 15px;
    opacity: .9;
}

#settingsBtn {
    background: none;
    border: none;
    color: var(--text);
    font-size: 20px;
    opacity: .8;
}

#settings {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: var(--panel);
    padding: 20px 16px 24px;
    transform: translateY(-100%);
    transition: transform .3s ease;
    z-index: 20;
}

#settings.open {
    transform: translateY(0);
}

.setting {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid rgba(255,255,255,.05);
    font-size: 14px;
}

.setting:last-child {
    border-bottom: none;
}

.setting label {
    color: var(--muted);
}

.setting input {
    transform: scale(1.2);
}

#viewer {
    height: 100%;
    padding-top: 56px;
    padding-bottom: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
}

img, video {
    max-width: 100%;
    max-height: 100%;
    border-radius: 8px;
}

video {
    background: #000;
}

#title {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 10px 14px 14px;
    font-size: 13px;
    text-align: center;
    color: var(--muted);
    background: linear-gradient(to top, rgba(0,0,0,.7), rgba(0,0,0,0));
}
</style>
</head>
<body>

<div id="topbar">
    <div id="brand">Ranmem</div>
    <button id="settingsBtn">⚙︎</button>
</div>

<div id="settings">
    <div class="setting">
        <label>Sadece video</label>
        <input type="checkbox" id="onlyVideo">
    </div>
    <div class="setting">
        <label>NSFW</label>
        <input type="checkbox" id="nsfw">
    </div>
</div>

<div id="viewer"></div>
<div id="title"></div>

<script>
const SUBS = {
    "KGBTR": ["anlık", "amk böyle işin", "Galerimden Fotoğraflar/Videolar"],
    "indirilenler": [],
    "vlandiya": ["shitpost", "Meme/Mizah"]
};

const viewer = document.getElementById("viewer");
const titleEl = document.getElementById("title");
const settings = document.getElementById("settings");

const onlyVideoEl = document.getElementById("onlyVideo");
const nsfwEl = document.getElementById("nsfw");

onlyVideoEl.checked = localStorage.getItem("onlyVideo") === "1";
nsfwEl.checked = localStorage.getItem("nsfw") === "1";

onlyVideoEl.onchange = () =>
    localStorage.setItem("onlyVideo", onlyVideoEl.checked ? "1" : "0");

nsfwEl.onchange = () =>
    localStorage.setItem("nsfw", nsfwEl.checked ? "1" : "0");

document.getElementById("settingsBtn").onclick = () =>
    settings.classList.toggle("open");

const seen = new Set(JSON.parse(localStorage.getItem("seenPosts") || "[]"));

let lastTap = 0;
document.body.addEventListener("touchend", tapHandler);
document.body.addEventListener("dblclick", loadMeme);

function tapHandler() {
    const now = Date.now();
    if (now - lastTap < 300) loadMeme();
    lastTap = now;
}

async function loadMeme() {
    viewer.innerHTML = "";
    titleEl.textContent = "Yükleniyor…";

    while (true) {
        const subs = Object.keys(SUBS);
        const sub = subs[Math.floor(Math.random() * subs.length)];
        const flairs = SUBS[sub];
        const flair = flairs.length
            ? flairs[Math.floor(Math.random() * flairs.length)]
            : null;

        let url = `https://www.reddit.com/r/${sub}/hot.json?limit=50`;
        if (flair)
            url += `&q=flair:"${encodeURIComponent(flair)}"&restrict_sr=1`;

        const res = await fetch(url);
        const json = await res.json();
        const posts = json.data.children.map(c => c.data).sort(() => Math.random() - .5);

        for (const post of posts) {
            if (seen.has(post.id)) continue;
            if (!nsfwEl.checked && post.over_18) continue;

            const isVideo = post.is_video;
            const isImage = post.post_hint === "image";

            if (onlyVideoEl.checked && !isVideo) continue;
            if (!isVideo && !isImage) continue;

            seen.add(post.id);
            localStorage.setItem("seenPosts", JSON.stringify([...seen]));

            render(post);
            return;
        }
    }
}

function render(post) {
    viewer.innerHTML = "";
    titleEl.textContent = post.title;

    if (post.is_video) {
        const v = document.createElement("video");
        v.src = post.media.reddit_video.fallback_url;
        v.autoplay = true;
        v.muted = true;
        v.playsInline = true;

        let unlocked = false;
        v.onclick = e => {
            e.stopPropagation();
            if (!unlocked) {
                v.muted = false;
                unlocked = true;
            }
            v.paused ? v.play() : v.pause();
        };

        viewer.appendChild(v);
    } else {
        const img = document.createElement("img");
        img.src = post.url;
        viewer.appendChild(img);
    }
}

loadMeme();
</script>

</body>
</html>
