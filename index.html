<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meme Viewer</title>

<style>
body {
    margin: 0;
    background: #0f0f0f;
    color: #fff;
    font-family: Arial, sans-serif;
    overflow: hidden;
}

/* ÜST BAR */
#topBar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: #1e1e1e;
    padding: 10px;
    display: none;
    gap: 10px;
    flex-wrap: wrap;
    z-index: 10;
}

#topBar input,
#topBar button,
#topBar label {
    font-size: 14px;
}

#toggleSettings {
    position: fixed;
    top: 10px;
    right: 12px;
    font-size: 22px;
    cursor: pointer;
    z-index: 11;
}

/* MEME */
#viewer {
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
}

video, img {
    max-width: 100%;
    max-height: 75vh;
    border-radius: 10px;
    cursor: pointer;
}

#title {
    margin-top: 12px;
    padding: 0 15px;
    font-size: 15px;
    opacity: 0.85;
}
</style>
</head>
<body>

<!-- AYAR AÇ -->
<div id="toggleSettings">⚙️</div>

<!-- ÜST AYAR BAR -->
<div id="topBar">
    <input id="subs" value="KGBTR,vlandiya,indirilenler" placeholder="Subredditler">
    <input id="flairs" value="shitpost,Meme/Mizah,anlık,amk böyle işin" placeholder="Flairler">

    <label>
        <input type="checkbox" id="onlyVideo">
        Sadece video
    </label>

    <button onclick="loadMemes()">Yükle</button>
</div>

<!-- MEME -->
<div id="viewer">
    <div id="media"></div>
    <div id="title"></div>
</div>

<script>
let memes = [];
let index = 0;
let clickTimer = null;

/* AYAR BAR TOGGLE */
document.getElementById("toggleSettings").onclick = () => {
    const bar = document.getElementById("topBar");
    bar.style.display = bar.style.display === "flex" ? "none" : "flex";
};

/* MEME YÜKLE */
async function loadMemes() {
    memes = [];
    index = 0;

    const subs = document.getElementById("subs").value
        .split(",")
        .map(s => s.trim());

    const flairs = document.getElementById("flairs").value
        .split(",")
        .map(f => f.trim().toLowerCase());

    const onlyVideo = document.getElementById("onlyVideo").checked;

    for (const sub of subs) {
        try {
            const res = await fetch(`https://www.reddit.com/r/${sub}/hot.json?limit=50`);
            const json = await res.json();

            json.data.children.forEach(p => {
                const d = p.data;

                if (flairs.length &&
                    (!d.link_flair_text ||
                     !flairs.includes(d.link_flair_text.toLowerCase()))) return;

                if (onlyVideo && !d.is_video) return;

                if (d.is_video || d.post_hint === "image") {
                    memes.push(d);
                }
            });
        } catch {}
    }

    if (!memes.length) {
        document.getElementById("media").innerHTML = "İçerik bulunamadı";
        document.getElementById("title").textContent = "";
        return;
    }

    showMeme();
}

/* MEME GÖSTER */
function showMeme() {
    const mediaBox = document.getElementById("media");
    mediaBox.innerHTML = "";

    const m = memes[index];
    let el;

    if (m.is_video) {
        el = document.createElement("video");
        el.src = m.media.reddit_video.fallback_url;
        el.autoplay = true;
        el.loop = true;
        el.muted = true;
        el.playsInline = true;
        el.controls = false;

        el.onclick = () => handleClick(el);
    } else {
        el = document.createElement("img");
        el.src = m.url;
        el.onclick = nextMeme;
    }

    mediaBox.appendChild(el);
    document.getElementById("title").textContent = m.title;
}

/* TIK KONTROL */
function handleClick(video) {
    if (clickTimer) {
        clearTimeout(clickTimer);
        clickTimer = null;
        nextMeme();
    } else {
        clickTimer = setTimeout(() => {
            video.paused ? video.play() : video.pause();
            clickTimer = null;
        }, 250);
    }
}

/* SONRAKİ */
function nextMeme() {
    index = (index + 1) % memes.length;
    showMeme();
}

loadMemes();
</script>

</body>
</html>
